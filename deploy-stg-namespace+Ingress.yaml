# Deployment for 2 public services (Stg Env)

###############################################################
# Tạo namespace cho môi trường Stg
###############################################################
kind: Namespace
apiVersion: v1
metadata:
  name: stg-custom-ns
  labels:
    name: stg-custom-ns
---

#################################################
# Config Ingress để routing HTTP Request dựa theo domain name để forward vào `main-service` thuộc namespace `stg-custom-ns`
#################################################
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: stg-public-services-http
  namespace: stg-custom-ns
  annotations:
    ingress.kubernetes.io/ssl-redirect: "false"
    kubernetes.io/ingress.class: traefik
    traefik.ingress.kubernetes.io/rewrite-target: / # set path to result request
spec:
  rules:
    - host: stg.chien.com
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: main-service
                port:
                  number: 5270     # Service giao tiếp qua port 5270